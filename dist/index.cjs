"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("leaflet");L.SVG.include({_resetTransformPath:function(t){t._path.setAttributeNS(null,"transform","")},transformPath:function(t,e){t._path.setAttributeNS(null,"transform","matrix("+e.join(" ")+")")}});L.SVG.include(L.Browser.vml?{_resetTransformPath:function(t){t._skew&&(t._skew.on=!1,t._path.removeChild(t._skew),t._skew=null)},transformPath:function(t,e){var i=t._skew;i||(i=L.SVG.create("skew"),t._path.appendChild(i),i.style.behavior="url(#default#VML)",t._skew=i);var a=e[0].toFixed(8)+" "+e[1].toFixed(8)+" "+e[2].toFixed(8)+" "+e[3].toFixed(8)+" 0 0",h=Math.floor(e[4]).toFixed()+", "+Math.floor(e[5]).toFixed(),n=this._path.style,s=parseFloat(n.left),o=parseFloat(n.top),_=parseFloat(n.width),l=parseFloat(n.height);isNaN(s)&&(s=0),isNaN(o)&&(o=0),(isNaN(_)||!_)&&(_=1),(isNaN(l)||!l)&&(l=1);var p=(-s/_-.5).toFixed(8)+" "+(-o/l-.5).toFixed(8);i.on="f",i.matrix=a,i.origin=p,i.offset=h,i.on=!0}}:{});function P(){return!0}L.Canvas.include({_resetTransformPath:function(t){this._containerCopy&&(delete this._containerCopy,t._containsPoint_&&(t._containsPoint=t._containsPoint_,delete t._containsPoint_,this._requestRedraw(t)))},transformPath:function(t,e){var i=this._containerCopy,a=this._ctx,h,n=L.Browser.retina?2:1,s=this._bounds,o=s.getSize(),_=s.min;i||(i=this._containerCopy=document.createElement("canvas"),h=i.getContext("2d"),i.width=n*o.x,i.height=n*o.y,this._removePath(t),this._redraw(),h.translate(n*s.min.x,n*s.min.y),h.drawImage(this._container,0,0),this._initPath(t),t._containsPoint_=t._containsPoint,t._containsPoint=P),a.save(),a.clearRect(_.x,_.y,o.x*n,o.y*n),a.setTransform(1,0,0,1,0,0),a.restore(),a.save(),a.drawImage(this._containerCopy,0,0,o.x,o.y),a.transform.apply(a,e),this._drawing=!0,t._updatePath(),this._drawing=!1,a.restore()}});/**
 * Leaflet vector features drag functionality
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */L.Path.include({_transform:function(t){return this._renderer&&(t?this._renderer.transformPath(this,t):(this._renderer._resetTransformPath(this),this._update())),this},_onMouseClick:function(t){this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)}});var v={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},b={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"};function y(t,e){var i=t.x-e.x,a=t.y-e.y;return Math.sqrt(i*i+a*a)}L.Handler.PathDrag=L.Handler.extend({statics:{DRAGGING_CLS:"leaflet-path-draggable"},initialize:function(t){this._path=t,this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._mapDraggingWasEnabled=!1},addHooks:function(){this._path.on("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className?this._path.options.className+" "+L.Handler.PathDrag.DRAGGING_CLS:L.Handler.PathDrag.DRAGGING_CLS,this._path._path&&L.DomUtil.addClass(this._path._path,L.Handler.PathDrag.DRAGGING_CLS)},removeHooks:function(){this._path.off("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className.replace(new RegExp("\\s+"+L.Handler.PathDrag.DRAGGING_CLS),""),this._path._path&&L.DomUtil.removeClass(this._path._path,L.Handler.PathDrag.DRAGGING_CLS)},moved:function(){return this._path._dragMoved},_onDragStart:function(t){var e=t.originalEvent._simulated?"touchstart":t.originalEvent.type;this._mapDraggingWasEnabled=!1,this._startPoint=t.containerPoint.clone(),this._dragStartPoint=t.containerPoint.clone(),this._matrix=[1,0,0,1,0,0],L.DomEvent.stop(t.originalEvent),L.DomUtil.addClass(this._path._renderer._container,"leaflet-interactive"),L.DomEvent.on(document,b[e],this._onDrag,this).on(document,v[e],this._onDragEnd,this),this._path._map.dragging.enabled()&&(this._path._map.dragging.disable(),this._mapDraggingWasEnabled=!0),this._path._dragMoved=!1,this._path._popup&&this._path._popup._close(),this._replaceCoordGetters(t)},_onDrag:function(t){L.DomEvent.stop(t);var e=t.touches&&t.touches.length>=1?t.touches[0]:t,i=this._path._map.mouseEventToContainerPoint(e);if(t.type==="touchmove"&&!this._path._dragMoved){var a=this._dragStartPoint.distanceTo(i);if(a<=this._path._map.options.tapTolerance)return}var h=i.x,n=i.y,s=h-this._startPoint.x,o=n-this._startPoint.y;(s||o)&&(this._path._dragMoved||(this._path._dragMoved=!0,this._path.fire("dragstart",t),this._path.bringToFront()),this._matrix[4]+=s,this._matrix[5]+=o,this._startPoint.x=h,this._startPoint.y=n,this._path.fire("predrag",t),this._path._transform(this._matrix),this._path.fire("drag",t))},_onDragEnd:function(t){var e=this._path._map.mouseEventToContainerPoint(t),i=this.moved();if(i&&(this._transformPoints(this._matrix),this._path._updatePath(),this._path._project(),this._path._transform(null),L.DomEvent.stop(t)),L.DomEvent.off(document,"mousemove touchmove",this._onDrag,this),L.DomEvent.off(document,"mouseup touchend",this._onDragEnd,this),this._restoreCoordGetters(),i){this._path.fire("dragend",{distance:y(this._dragStartPoint,e)});var a=this._path._containsPoint;this._path._containsPoint=L.Util.falseFn,L.Util.requestAnimFrame(function(){L.DomEvent.skipped({type:"click"}),this._path._containsPoint=a},this)}this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._path._dragMoved=!1,this._mapDraggingWasEnabled&&(i&&L.DomEvent.fakeStop({type:"click"}),this._path._map.dragging.enable())},_transformPoints:function(t,e){var i=this._path,a,h,n,s=L.point(t[4],t[5]),o=i._map.options.crs,_=o.transformation,l=o.scale(i._map.getZoom()),p=o.projection,f=_.untransform(s,l).subtract(_.untransform(L.point(0,0),l)),m=!e;if(i._bounds=new L.LatLngBounds,i._point)e=p.unproject(p.project(i._latlng)._add(f)),m&&(i._latlng=e,i._point._add(s));else if(i._rings||i._parts){var u=i._rings||i._parts,g=i._latlngs;for(e=e||g,L.Util.isArray(g[0])||(g=[g],e=[e]),a=0,h=u.length;a<h;a++){e[a]=e[a]||[];for(var d=0,x=u[a].length;d<x;d++)n=g[a][d],e[a][d]=p.unproject(p.project(n)._add(f)),m&&(i._bounds.extend(g[a][d]),u[a][d]._add(s))}}return e},_replaceCoordGetters:function(){this._path.getLatLng?(this._path.getLatLng_=this._path.getLatLng,this._path.getLatLng=L.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,{})},this._path)):this._path.getLatLngs&&(this._path.getLatLngs_=this._path.getLatLngs,this._path.getLatLngs=L.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,[])},this._path))},_restoreCoordGetters:function(){this._path.getLatLng_?(this._path.getLatLng=this._path.getLatLng_,delete this._path.getLatLng_):this._path.getLatLngs_&&(this._path.getLatLngs=this._path.getLatLngs_,delete this._path.getLatLngs_)}});L.Handler.PathDrag.makeDraggable=function(t){return t.dragging=new L.Handler.PathDrag(t),t};L.Path.prototype.makeDraggable=function(){return L.Handler.PathDrag.makeDraggable(this)};L.Path.addInitHook(function(){this.options.draggable?(this.options.interactive=!0,this.dragging?this.dragging.enable():(L.Handler.PathDrag.makeDraggable(this),this.dragging.enable())):this.dragging&&this.dragging.disable()});L.Path.Drag;const k=r.CircleMarker.extend({options:{textStyle:{color:"#fff",fontSize:12,fontWeight:300},shiftY:7},initialize(t,e,i){this._text=t,this._textElement=null,this._textNode=null,this._textLayer=null,r.CircleMarker.prototype.initialize.call(this,e,i)},setText(t){return this._text=t,this._textNode&&this._textElement.removeChild(this._textNode),this._textNode=document.createTextNode(this._text),this._textElement.appendChild(this._textNode),this},getText(){return this._text},bringToFront(){return r.CircleMarker.prototype.bringToFront.call(this),this._groupTextToPath(),this},bringToBack(){return r.CircleMarker.prototype.bringToBack.call(this),this._groupTextToPath(),this},_groupTextToPath(){const t=this._path,e=this._textElement,i=t.nextSibling,a=t.parentNode;e&&a&&(a.insertAfter?a.insertAfter(t,e):a.insertBefore(e,i))},_updatePath(){r.CircleMarker.prototype._updatePath.call(this),this._updateTextPosition()},_transform(t){r.CircleMarker.prototype._transform.call(this,t),this._textLayer=this._textLayer||{_path:this._textElement},t?this._renderer.transformPath(this._textLayer,t):(this._renderer._resetTransformPath(this._textLayer),this._updateTextPosition(),this._textLayer=null)},onAdd(t){return r.CircleMarker.prototype.onAdd.call(this,t),this._initText(),this._updateTextPosition(),this.setStyle({}),this},_initText(){this._textElement=r.SVG.create("text"),this.setText(this._text),this._renderer._rootGroup.appendChild(this._textElement)},_updateTextPosition(){const t=this._textElement;if(t){const e=t.getBBox({stroke:!0,markers:!0}),i=this._point.subtract(r.point(e.width,-e.height+this.options.shiftY).divideBy(2));t.setAttribute("x",i.x),t.setAttribute("y",i.y),this._groupTextToPath()}},setStyle(t){if(r.CircleMarker.prototype.setStyle.call(this,t),this._textElement){const e=this.options.textStyle;for(let i in e)if(e.hasOwnProperty(i)){let a=i;i==="color"&&(a="stroke"),this._textElement.style[a]=e[i]}}},onRemove(t){return this._textElement&&(this._textElement.parentNode&&this._textElement.parentNode.removeChild(this._textElement),this._textElement=null,this._textNode=null,this._textLayer=null),r.CircleMarker.prototype.onRemove.call(this,t)}}),c=r.FeatureGroup.extend({options:{getLabelText:(t,e)=>e.properties.text,getLabelPosition:(t,e,i)=>{if(e.properties.labelPosition){const a=e.properties.labelPosition.slice().reverse();return r.latLng(a)}return i},labelPositionKey:"labelPosition",markerOptions:{color:"#f00",fillOpacity:.75,draggable:!0,radius:15},anchorOptions:{color:"#00f",radius:3},lineOptions:{color:"#f00",dashArray:[2,6],lineCap:"square",weight:2}},initialize(t,e,i){r.Util.setOptions(this,i),this.feature=e||{type:"Feature",properties:{},geometry:{type:"Point"}},this._latlng=t,this._marker=null,this._anchor=null,this._line=null,this._initialDistance=null,this._createLayers(),r.LayerGroup.prototype.initialize.call(this,[this._anchor,this._line,this._marker])},getLabelPosition(){return this._marker.getLatLng()},getLatLng(){return this._latlng},toGeoJSON(t){const e=r.GeoJSON.getFeature(this,{type:"Point",coordinates:r.GeoJSON.latLngToCoords(this._anchor.getLatLng())});return e.properties[this.options.labelPositionKey]=r.GeoJSON.latLngToCoords(this._marker.getLatLng()),e.properties.text=this._marker.getText(),t?D(e,this.options.labelPositionKey):e},setText(t){return this._marker.setText(t),this},_createLayers(){const t=this.options,e=t.getLabelPosition(this,this.feature,this._latlng),i=t.getLabelText(this,this.feature);"draggable"in t&&(t.markerOptions.draggable=t.draggable),this._marker=new k(i,e,{interactive:this.options.interactive,...c.prototype.options.markerOptions,...t.markerOptions}).on("drag",this._onMarkerDrag,this).on("dragstart",this._onMarkerDragStart,this).on("dragend",this._onMarkerDragEnd,this),this._anchor=new r.CircleMarker(this._latlng,r.Util.extend({},c.prototype.options.anchorOptions,t.anchorOptions)),this._line=new r.Polyline([this._latlng,this._marker.getLatLng()],r.Util.extend({},c.prototype.options.lineOptions,t.lineOptions))},_onMarkerDragStart(t){this._initialDistance=r.DomEvent.getMousePosition(t).subtract(this._map.latLngToContainerPoint(this._marker.getLatLng())),this.fire("label:"+t.type,t)},_onMarkerDrag(t){const e=this._map.containerPointToLatLng(r.DomEvent.getMousePosition(t)._subtract(this._initialDistance));this._line.setLatLngs([e,this._latlng]),this.fire("label:"+t.type,t)},_onMarkerDragEnd(t){this._line.setLatLngs([this._marker.getLatLng(),this._latlng]),this.fire("label:"+t.type,t)},enableDragging(){return this._marker.dragging&&this._marker.dragging.enable(),this},disableDragging(){return this._marker.dragging&&this._marker.dragging.disable(),this}});function D(t,e){e=e||"labelPosition";const i=t.geometry.coordinates.slice();let a=t.properties[e];if(!a)throw new Error("No label position set");a=a.slice();const h=[{type:"Point",coordinates:i},{type:"LineString",coordinates:[i.slice(),a]},{type:"Point",coordinates:a.slice()},{type:"Point",coordinates:a.slice()}];return{type:"Feature",properties:{...t.properties,geometriesTypes:["anchor","connection","label","textbox"]},bbox:t.bbox,geometry:{type:"GeometryCollection",geometries:h}}}const C=(t,e,i)=>new c(t,e,i);exports.LabeledCircleMarker=c;exports.labeledCircleMarker=C;
